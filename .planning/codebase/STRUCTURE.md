# Codebase Structure

**Analysis Date:** 2026-02-21

## Directory Layout

```
productivity-game/
├── public/                          # Static assets served by Vite
│   ├── assets/
│   │   ├── sprites/
│   │   │   ├── map1.png            # Town background map
│   │   │   ├── taskmaster.png      # NPC sprite
│   │   │   ├── taskboard.png       # Productivity board sprite
│   │   │   ├── dungeon.png         # Dungeon entrance sprite
│   │   │   ├── ARENA1background.png # Battle arena background
│   │   │   ├── Baddiearena1.png    # Boss sprite
│   │   │   └── manaseed/           # Mana Seed paper doll sprite sheets
│   │   │       └── Character_Base_2.5c/
│   │   │           └── char_a_p1/  # Page 1 (walking/idle)
│   │   │               ├── (base body layers)
│   │   │               ├── 1out/   # Outfit layers
│   │   │               ├── 4har/   # Hair layers
│   │   │               └── 5hat/   # Hat layers
│   │   │       └── Bow_Combat_3.2/ # Combat pages for bow
│   │   └── music/
│   │       └── town-theme.wav      # Background music loop
│   └── index.html                   # Root HTML file
│
├── src/
│   ├── main.jsx                     # React entry point (mounts to DOM)
│   ├── App.jsx                      # Root React component (game orchestrator)
│   ├── App.css                      # Root styling
│   ├── index.css                    # Global styles
│   ├── config.js                    # (legacy, minimal)
│   │
│   ├── scenes/
│   │   └── MainScene.js             # Phaser game scene (world, sprites, input)
│   │
│   ├── components/                  # React modal/UI components
│   │   ├── TitleScreen.jsx          # Opening title sequence
│   │   ├── MainMenu.jsx             # Main menu with load/new game
│   │   ├── SaveSlotSelection.jsx    # Save slot UI helper
│   │   ├── CharacterCreationModal.jsx # Class/appearance/stat selection
│   │   ├── CharacterPanel.jsx       # Character sheet overlay
│   │   ├── CharacterHUD.jsx         # (legacy)
│   │   ├── SimpleHUD.jsx            # Top-left HUD (portrait, XP bar, level)
│   │   ├── PaperDollPreview.jsx     # Appearance customization preview
│   │   ├── TaskSubmissionModal.jsx  # Real-world task entry form
│   │   ├── BattleModal.jsx          # Battle/dungeon UI (side-view combat)
│   │   ├── ArenaModal.jsx           # Arena multi-battle mode
│   │   ├── DungeonConfirm.jsx       # Confirmation dialog before battle
│   │   ├── WeeklyQuestsModal.jsx    # Weekly quests list
│   │   └── *.css                    # Component-specific styles
│   │
│   └── config/                      # Game configuration & data
│       ├── classes.js               # Class definitions (stats, colors, icons)
│       ├── appearance.js            # Paper doll sprite configuration & helpers
│       ├── abilities.js             # Ability definitions by class (unlocks, effects)
│       ├── equipment.js             # Equipment database & defaults
│       └── levelingSystem.js        # XP table & level-up calculation
│
├── .planning/codebase/              # GSD codebase analysis documents
├── dist/                            # Build output (generated by Vite)
├── node_modules/                    # Dependencies (generated)
├── .env                             # Environment variables (secrets)
├── .env.example                     # Example env vars (template)
├── .gitignore                       # Git exclusions
├── package.json                     # NPM dependencies & scripts
├── package-lock.json                # Locked dependency versions
├── vite.config.js                   # Vite build configuration
├── eslint.config.js                 # ESLint rules
├── index.html                       # (root HTML, see public/)
│
├── DEPLOYMENT.md                    # Deployment guide
├── SETUP.md                         # Development setup guide
├── README.md                        # Project overview
│
└── (Scripts at root)
    ├── server.js                    # Express backend (AI task scoring)
    ├── convert_transparency.py      # Asset processing utility
    ├── extract_class_huds.py        # Sprite extraction utility
    └── extract_scrolls_title.py     # Sprite extraction utility
```

## Directory Purposes

**public/assets/sprites/:**
- Purpose: Game sprite graphics (map, NPCs, combat backgrounds, paper doll layers)
- Contains: PNG images for all visual assets
- Key files: manaseed/ folder with 512x512 sprite sheets (64x64 frame cells in 8×8 grid)

**public/assets/music/:**
- Purpose: Audio tracks
- Contains: WAV files for background music
- Key files: town-theme.wav (looped in MainScene)

**src/scenes/:**
- Purpose: Phaser scene definitions
- Contains: Only MainScene.js (single-scene game)
- Key files: `MainScene.js` (all game world logic)

**src/components/:**
- Purpose: React UI overlays and modals
- Contains: Modal JSX files and associated CSS
- Key files: `App.jsx`, `TaskSubmissionModal.jsx`, `BattleModal.jsx`, `CharacterCreationModal.jsx`

**src/config/:**
- Purpose: Game data and configuration
- Contains: Class stats, abilities, equipment, sprite mappings, leveling formulas
- Key files: `classes.js`, `appearance.js`, `abilities.js`, `equipment.js`, `levelingSystem.js`

## Key File Locations

**Entry Points:**
- `public/index.html`: HTML root, loads React app
- `src/main.jsx`: React app mount point
- `src/App.jsx`: Root React component, creates Phaser game

**Configuration:**
- `vite.config.js`: Build and dev server setup
- `package.json`: Dependencies and npm scripts
- `.env`: Environment variables (secrets, not committed)
- `eslint.config.js`: Code linting rules

**Core Logic:**
- `src/App.jsx`: Player state, modal coordination, save/load, React-Phaser event bridge
- `src/scenes/MainScene.js`: Game world, player movement, NPC interactions, animations
- `src/config/classes.js`: Class base stats and visual defaults
- `src/config/abilities.js`: Ability definitions and unlock levels
- `src/config/appearance.js`: Paper doll sprite sheet configuration
- `src/config/equipment.js`: Equipment database and combat type mappings

**Testing:**
- No test files present; no test framework configured

## Naming Conventions

**Files:**
- React components: PascalCase + `.jsx` (e.g., `TaskSubmissionModal.jsx`)
- Phaser scenes: PascalCase + `.js` (e.g., `MainScene.js`)
- Config files: camelCase + `.js` (e.g., `levelingSystem.js`)
- Styles: Component name + `.css` (e.g., `BattleModal.css`)

**Directories:**
- Feature/domain-based: `components/`, `config/`, `scenes/`
- Asset structure mirrors Mana Seed pack: `public/assets/sprites/manaseed/Character_Base_2.5c/char_a_p1/`

**Functions & Variables:**
- Camel case throughout (e.g., `calculateLevelUp`, `playerStats`, `isDragging`)
- Mana Seed textures: `ms_` prefix (e.g., `ms_base_v01`, `ms_hair_dap1_v02`)
- Animation keys: `ms_walk_down`, `ms_idle_up` (Phaser animation naming)
- Config constants: UPPER_SNAKE_CASE (e.g., `CLASS_CONFIG`, `ABILITY_TYPES`, `MS_ANIMS`)

## Where to Add New Code

**New Feature:**
- Primary code: Add feature-specific logic to `src/App.jsx` (state management) or `src/scenes/MainScene.js` (game world)
- Tests: No test infrastructure; add manual testing steps to DEPLOYMENT.md
- Config: Add constants to appropriate file in `src/config/` (e.g., new class → `classes.js`)

**New Component/Modal:**
- Implementation: Create new JSX file in `src/components/` (e.g., `NewModalName.jsx`)
- Styling: Paired CSS file (e.g., `NewModalName.css`)
- Integration: Import in `App.jsx`, manage visibility with useState, wire event handlers
- Event coordination: Use `game.events.emit/on` pattern for Phaser communication

**New Ability / Class:**
- Ability: Add to `ABILITIES` object in `src/config/abilities.js`
- Class: Add to `CLASS_CONFIG` in `src/config/classes.js`, define default appearance in `appearance.js`, default equipment in `equipment.js`
- Sprite assets: Add texture keys to appearance.js and sprite sheets to `public/assets/sprites/manaseed/`

**Utilities:**
- Shared helpers: Add to `src/config/` as standalone functions (e.g., `levelingSystem.js` exports `calculateLevelUp()`)
- Math/calculations: Place in config file closest to domain (e.g., combat math in `abilities.js`)

## Special Directories

**dist/:**
- Purpose: Build output directory
- Generated: Yes (created by `npm run build`)
- Committed: No (.gitignore excludes)

**node_modules/:**
- Purpose: NPM dependencies
- Generated: Yes (created by `npm install`)
- Committed: No (.gitignore excludes)

**.git/:**
- Purpose: Git version control
- Generated: Yes (initialized by `git init`)
- Committed: Yes

**public/assets/sprites/manaseed/:**
- Purpose: Mana Seed Character Base sprite asset pack (third-party)
- Generated: No (manually downloaded and placed)
- Committed: Yes (asset files needed for builds)

---

*Structure analysis: 2026-02-21*
