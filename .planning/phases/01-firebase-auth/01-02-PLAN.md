---
phase: 01-firebase-auth
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - src/components/AuthModal.jsx
  - src/components/AuthModal.css
  - src/components/SplashScreen.jsx
  - src/components/SplashScreen.css
autonomous: true
requirements:
  - ACCT-01
  - ACCT-02
  - ACCT-03

must_haves:
  truths:
    - "User can see a registration form with username, email, password, and confirm password fields"
    - "User can toggle between Login and Sign Up views on the same modal"
    - "User can see inline validation errors below specific fields when input is invalid"
    - "User can tap 'Forgot password?' to enter email and receive a reset link"
    - "User sees Scrolls of Doom logo on a black splash screen while auth state resolves"
    - "Splash screen shows a subtle glow animation on the logo"
  artifacts:
    - path: "src/components/AuthModal.jsx"
      provides: "Combined register/login/forgot-password modal with RPG theme"
      min_lines: 150
    - path: "src/components/AuthModal.css"
      provides: "RPG parchment-themed styles matching existing modal conventions"
      contains: "parchment"
    - path: "src/components/SplashScreen.jsx"
      provides: "Splash screen with logo and glow animation"
      min_lines: 20
    - path: "src/components/SplashScreen.css"
      provides: "Black background splash with glow keyframe animation"
      contains: "@keyframes"
  key_links:
    - from: "src/components/AuthModal.jsx"
      to: "src/hooks/useAuth.js"
      via: "useAuth() hook for register, login, resetPassword, getAuthErrorMessage"
      pattern: "useAuth\\(\\)"
    - from: "src/components/AuthModal.jsx"
      to: "src/components/AuthModal.css"
      via: "CSS import"
      pattern: "import.*AuthModal\\.css"
    - from: "src/components/SplashScreen.jsx"
      to: "src/components/SplashScreen.css"
      via: "CSS import"
      pattern: "import.*SplashScreen\\.css"
---

<objective>
Build the AuthModal component (combined register/login/forgot-password UI with RPG parchment theme) and SplashScreen component (logo on black background with glow animation) that together form the visual auth experience.

Purpose: These components are the user-facing auth interface. AuthModal collects credentials and drives registration/login flows. SplashScreen fills the gap while Firebase resolves auth state on page load (and shows after logout).

Output: `src/components/AuthModal.jsx`, `src/components/AuthModal.css`, `src/components/SplashScreen.jsx`, `src/components/SplashScreen.css`
</objective>

<execution_context>
@C:/Users/jarre/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/jarre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-firebase-auth/01-CONTEXT.md
@.planning/phases/01-firebase-auth/01-RESEARCH.md
@.planning/phases/01-firebase-auth/01-01-SUMMARY.md
@src/components/TaskSubmissionModal.css
@src/components/MainMenu.css
@src/components/TitleScreen.jsx
@src/components/TitleScreen.css
@src/components/CharacterCreationModal.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SplashScreen component with logo and glow animation</name>
  <files>src/components/SplashScreen.jsx, src/components/SplashScreen.css</files>
  <action>
Create SplashScreen to replace TitleScreen for the auth flow. This displays while Firebase resolves auth state and also shows after logout before the auth modal appears.

**SplashScreen.jsx:**
- Props: `showError` (boolean, optional — true when auto-login fails), `errorMessage` (string, optional), `onRetry` (function, optional — retry button callback)
- No auto-dismiss timers — component stays visible until parent unmounts it (auth state determines visibility, not timers)
- Render:
  - Full-viewport black background div (`.splash-screen`)
  - Scrolls of Doom logo: `<img src="/assets/sprites/scrolls-of-doom-logo.png" alt="Scrolls of Doom" className="splash-logo" />`
  - Logo has CSS class for glow animation (`.splash-logo` with `splash-glow` keyframes)
  - If `showError` is true, render error message text and a "Retry" button below the logo
  - No "Tap to continue" text (unlike TitleScreen — per CONTEXT.md: no loading indicator, logo + glow implies loading)

**SplashScreen.css:**
- `.splash-screen`: Full viewport (`position: fixed; inset: 0`), black background, flexbox centering, `z-index: 9999` (above everything)
- `.splash-logo`: Max width ~60% viewport, `filter: drop-shadow(...)` for the glow, animation: `splash-glow 2s ease-in-out infinite alternate`
- `@keyframes splash-glow`: Animate between a subtle warm glow and a slightly brighter glow using `filter: drop-shadow(0 0 Npx rgba(255, 200, 100, alpha))`. Start at alpha ~0.4 and end at alpha ~0.8. Keep it subtle — per CONTEXT.md this is not full animated flames.
- Error text: White text, centered below logo, using game's warning color for the actual error message
- Retry button: Styled like a simple RPG button (parchment gradient from existing palette, dark brown text, rounded corners)
- Fade-in animation on the splash screen itself: `opacity 0 -> 1` over ~0.5s
  </action>
  <verify>
- `src/components/SplashScreen.jsx` renders logo with glow animation class
- `src/components/SplashScreen.css` has `@keyframes splash-glow` animation
- Component renders without errors when imported standalone (no auth dependency — it is purely presentational)
  </verify>
  <done>SplashScreen displays Scrolls of Doom logo centered on black background with subtle pulsing glow animation. Supports optional error state with retry button for auto-login failures.</done>
</task>

<task type="auto">
  <name>Task 2: Create AuthModal component with register/login/forgot-password views</name>
  <files>src/components/AuthModal.jsx, src/components/AuthModal.css</files>
  <action>
Create the combined auth form modal with RPG parchment theme. This is a modal overlay — full-screen on mobile (game is mobile-first per CONTEXT.md).

**AuthModal.jsx:**

Props: `isOpen` (boolean), `onAuthSuccess` (callback — called after successful login or registration)

State:
- `view`: `'login'` | `'register'` | `'forgot'` (starts at `'login'`)
- `username` (string)
- `email` (string — only shown on register and forgot-password views)
- `password` (string)
- `confirmPassword` (string — only on register view)
- `showPassword` (boolean — eye icon toggle)
- `errors` (object: `{ username: '', email: '', password: '', confirmPassword: '', general: '' }`)
- `isSubmitting` (boolean)
- `showSuccess` (string — brief success message: `'Account created!'` or `'Check your email'`)

Guard clause: `if (!isOpen) return null`

**Registration view (`view === 'register'`):**
- Fields: username, email, password (with show/hide toggle), confirm password
- Username validation on submit (NOT real-time per CONTEXT.md):
  - 3-20 characters
  - Letters, numbers, underscores only (`/^[a-zA-Z0-9_]{3,20}$/`)
  - No format hints on the field — only show errors on invalid input (per CONTEXT.md)
- Email: basic format validation
- Password: Firebase defaults (6-char minimum) — validate before submit
- Confirm password: must match password
- Submit button: "Sign Up" (per CONTEXT.md: straightforward labels, not RPG-flavored)
- Submit button disables with spinner while `isSubmitting` is true (per CONTEXT.md)
- On submit:
  - Client-side validate all fields. Set per-field inline errors for any failures.
  - If valid, call `register(username, email, password)` from useAuth
  - On success: show `'Account created!'` message briefly (1.5s) via `showSuccess` state, then call `onAuthSuccess()`
  - On error: call `getAuthErrorMessage(error)` and set appropriate field error (username errors -> `errors.username`, email errors -> `errors.email`, password errors -> `errors.password`, other -> `errors.general`)
- Toggle link at bottom: "Already have an account? Log In" — sets view to `'login'`

**Login view (`view === 'login'`):**
- Fields: username, password (with show/hide toggle)
- No email field (per CONTEXT.md: username is the login credential)
- Submit button: "Log In"
- On submit:
  - Call `login(username, password)` from useAuth
  - On success: call `onAuthSuccess()`
  - On error: set `errors.general` with `getAuthErrorMessage(error)`
- "Forgot password?" link below submit button (per CONTEXT.md) — sets view to `'forgot'`
- Toggle link at bottom: "Don't have an account? Sign Up" — sets view to `'register'`

**Forgot password view (`view === 'forgot'`):**
- Fields: email only
- Submit button: "Send Reset Link"
- On submit:
  - Call `resetPassword(email)` from useAuth
  - On success: show `'Check your email for a reset link'` via `showSuccess`
  - On error: set `errors.email` with error message
- "Back to Log In" link — sets view to `'login'`

**Error display (all views):**
- Inline errors below specific fields (per CONTEXT.md)
- Errors persist until field is corrected (per CONTEXT.md — not auto-dismiss)
- Clear field-specific error when user modifies that field (onChange handler clears `errors[fieldName]`)
- Error text uses the game's existing danger color (#8b3030 from CharacterCreationModal.css)

**Success display:**
- When `showSuccess` is truthy, show a centered success message (green/gold themed) overlaying the form briefly
- Auto-clear after 1.5 seconds, then call `onAuthSuccess()`

**Layout (mobile-first):**
- "Scrolls of Doom" logo/title art displayed prominently above the form (per CONTEXT.md)
- Logo: `<img src="/assets/sprites/scrolls-of-doom-logo.png" alt="Scrolls of Doom" className="auth-logo" />`
- Blurred game world as background: the modal overlay should use `backdrop-filter: blur(8px) brightness(0.6)` (per existing MainMenu.css pattern and CONTEXT.md)
- Modal overlay: full-viewport fixed position
- Modal content: parchment-style background, max-width ~400px centered, full-width on mobile
- Smooth fade-in animation for the modal (per CONTEXT.md)

**AuthModal.css:**
Reuse existing RPG parchment theme tokens from the codebase:
- Parchment background: `linear-gradient(170deg, #f4e4c1 0%, #e8d5a3 40%, #dcc896 70%, #e8d5a3 100%)`
- Dark brown text: `#3b2415`
- Muted brown secondary text: `#7a5c3a`
- Border: `3px solid #a08050`
- Error color: `#8b3030`
- Input background: `rgba(244, 228, 193, 0.5)`
- Primary button gradient: `linear-gradient(145deg, #8b7355, #6b5335)` with text `#f4e4c1`
- Blur backdrop: `backdrop-filter: blur(8px) brightness(0.6)`

Key CSS classes:
- `.auth-overlay`: Fixed full-viewport, flex centering, backdrop blur, z-index: 1000, fade-in animation
- `.auth-modal`: Parchment background, rounded corners, padding, max-width 400px, width 90vw (mobile-first), border, box-shadow for depth
- `.auth-logo`: Centered above form, max-width ~200px, margin-bottom
- `.auth-form`: Column flex layout, gap between fields
- `.auth-field`: Label + input + error message container
- `.auth-field input`: Parchment input background, dark brown text, border-bottom style, focus ring
- `.auth-field-error`: Error text in #8b3030, font-size 0.85rem, below the field
- `.auth-password-wrapper`: Relative container for input + eye icon toggle button
- `.auth-toggle-password`: Absolute positioned eye icon button inside password field
- `.auth-submit-btn`: Primary button gradient, full width, disabled state (opacity 0.6), spinner inside when loading
- `.auth-toggle-link`: Secondary text color, underline, clickable, centered
- `.auth-forgot-link`: Below submit, smaller text, clickable
- `.auth-success-message`: Centered, gold/green text, brief display
- `.auth-general-error`: Red background strip above the form for general errors
- `@keyframes auth-fade-in`: opacity 0 -> 1 over 0.3s
- `@media (max-width: 480px)`: auth-modal goes full-screen (width: 100%, height: 100%, border-radius: 0, max-width: none)

Password show/hide toggle: Use a simple text button ("Show"/"Hide") or an eye emoji inside the password field wrapper. Keep it simple — no icon library needed.
  </action>
  <verify>
- `src/components/AuthModal.jsx` exports default component with login/register/forgot views
- `src/components/AuthModal.css` contains parchment theme classes matching existing project palette
- Component renders each view (login, register, forgot) without errors
- Form fields have inline error containers
- Submit buttons disable during submission
- `npm run build` succeeds
  </verify>
  <done>AuthModal provides combined register/login/forgot-password UI with RPG parchment theme, inline field validation, password show/hide toggle, success confirmations, and mobile-first full-screen layout. All error messages are human-readable via getAuthErrorMessage.</done>
</task>

</tasks>

<verification>
- Both components render without runtime errors
- AuthModal correctly imports and uses `useAuth()` hook
- AuthModal toggles between three views (login, register, forgot password)
- SplashScreen shows logo with glow animation
- CSS reuses existing parchment color palette from the project
- `npm run build` succeeds with no import errors
</verification>

<success_criteria>
AuthModal handles registration with username/email/password/confirm, login with username/password, and forgot password with email. Inline validation errors display below fields. Submit buttons disable during requests. SplashScreen displays logo with subtle glow animation on black background. Both components use RPG parchment theme consistent with existing modals.
</success_criteria>

<output>
After completion, create `.planning/phases/01-firebase-auth/01-02-SUMMARY.md`
</output>
